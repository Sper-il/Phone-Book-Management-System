<!doctype html>
<html class="light" lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create New Group | ContactHub</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#136dec",
            "background": "#f5f7fa",
            "sidebar": "#f8f9fa",
            "border-color": "#e5e7eb"
          },
          fontFamily: {
            "sans": ["Inter", "sans-serif"]
          }
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    .input-field:focus {
      box-shadow: 0 0 0 3px rgba(19, 109, 236, 0.15);
    }
    .color-option {
      transition: all 0.2s ease;
    }
    .color-option:hover {
      transform: scale(1.15);
    }
    .color-option.selected {
      transform: scale(1.2);
      box-shadow: 0 0 0 3px white, 0 0 0 5px currentColor;
    }
    .toast-animation {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .confirm-dialog { animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  </style>
</head>
<body class="min-h-screen bg-background font-sans antialiased">
  <!-- Confirm Dialog -->
  <div id="confirm-dialog" class="hidden fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
    <div class="confirm-dialog bg-white rounded-xl shadow-2xl max-w-md w-full p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
          <span class="material-symbols-outlined text-red-600">warning</span>
        </div>
        <h3 id="confirm-title" class="text-lg font-semibold text-gray-900">Confirm</h3>
      </div>
      <p id="confirm-message" class="text-gray-600 mb-6">Are you sure?</p>
      <div class="flex justify-end gap-3">
        <button onclick="hideConfirm(false)" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium text-gray-700">Cancel</button>
        <button onclick="hideConfirm(true)" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium">Delete</button>
      </div>
    </div>
  </div>

  <!-- Top Navigation Bar -->
  <nav class="bg-white border-b border-border-color shadow-sm sticky top-0 z-50">
    <div class="max-w-5xl mx-auto px-4 sm:px-6">
      <div class="flex items-center justify-between h-16">
        <a href="/groups" class="flex items-center gap-2 text-primary hover:text-blue-700 transition-colors">
          <span class="material-symbols-outlined">arrow_back</span>
          <span class="font-medium hidden sm:inline">Back to Groups</span>
        </a>
        <h1 class="text-lg font-semibold text-gray-800">Create New Group</h1>
        <div class="w-10"></div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-xl mx-auto px-4 py-8">
    <div class="bg-white rounded-2xl shadow-lg border border-border-color overflow-hidden">
      <!-- Header with Icon -->
      <div class="bg-gradient-to-r from-purple-500 to-indigo-600 px-8 py-10 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full mb-4 border-4 border-white/30">
          <span class="material-symbols-outlined text-white" style="font-size: 40px;">group_add</span>
        </div>
        <h2 class="text-xl font-semibold text-white">Create Contact Group</h2>
        <p class="text-purple-100 text-sm mt-1">Organize your contacts into groups for easy management</p>
      </div>

      <!-- Form Body -->
      <form id="addGroupForm" class="p-8 space-y-6" novalidate>
        <!-- Group Name -->
        <div class="space-y-2">
          <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
            <span class="material-symbols-outlined text-primary" style="font-size: 18px;">label</span>
            Group Name <span class="text-red-500">*</span>
          </label>
          <input 
            name="groupName" 
            id="groupName"
            required 
            class="input-field w-full border border-gray-300 rounded-xl px-4 py-3.5 focus:border-primary focus:outline-none transition-all" 
            placeholder="e.g. Family, Work, Friends..." 
          />
        </div>

        <!-- Color Selection -->
        <div class="space-y-3">
          <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
            <span class="material-symbols-outlined text-primary" style="font-size: 18px;">palette</span>
            Choose Group Color
          </label>
          
          <div class="flex flex-wrap gap-3 p-4 bg-gray-50 rounded-xl">
            <button type="button" class="color-option w-10 h-10 rounded-full bg-red-500 hover:bg-red-600" data-color="#EF4444" title="Red"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-orange-500 hover:bg-orange-600" data-color="#F97316" title="Orange"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-amber-500 hover:bg-amber-600" data-color="#F59E0B" title="Yellow"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-green-500 hover:bg-green-600" data-color="#22C55E" title="Green"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-teal-500 hover:bg-teal-600" data-color="#14B8A6" title="Teal"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 selected" data-color="#3B82F6" title="Blue"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-indigo-500 hover:bg-indigo-600" data-color="#6366F1" title="Indigo"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-purple-500 hover:bg-purple-600" data-color="#A855F7" title="Purple"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-pink-500 hover:bg-pink-600" data-color="#EC4899" title="Pink"></button>
            <button type="button" class="color-option w-10 h-10 rounded-full bg-gray-500 hover:bg-gray-600" data-color="#6B7280" title="Gray"></button>
          </div>
          
          <input type="hidden" name="color" id="colorInput" value="#3B82F6" />
          
          <!-- Custom Color Input -->
          <div class="flex items-center gap-3">
            <span class="text-sm text-gray-500">Or enter color code:</span>
            <div class="flex items-center gap-2">
              <div id="colorPreview" class="w-8 h-8 rounded-lg border-2 border-gray-200" style="background-color: #3B82F6;"></div>
              <input 
                type="text" 
                id="customColor"
                class="w-28 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-primary focus:outline-none" 
                placeholder="#3B82F6"
                value="#3B82F6"
              />
            </div>
          </div>
        </div>

        <!-- Description (Optional) -->
        <div class="space-y-2">
          <label class="flex items-center gap-2 text-sm font-semibold text-gray-700">
            <span class="material-symbols-outlined text-primary" style="font-size: 18px;">description</span>
            Description <span class="text-gray-400 font-normal">(optional)</span>
          </label>
          <textarea 
            name="description" 
            id="description"
            rows="2"
            class="input-field w-full border border-gray-300 rounded-xl px-4 py-3 focus:border-primary focus:outline-none transition-all resize-none" 
            placeholder="Add a description for this group..."
          ></textarea>
        </div>

        <!-- Preview Card -->
        <div class="p-4 bg-gray-50 rounded-xl border border-gray-200">
          <p class="text-xs text-gray-500 uppercase tracking-wide mb-2">Preview</p>
          <div class="flex items-center gap-3">
            <div id="previewIcon" class="w-12 h-12 rounded-xl flex items-center justify-center" style="background-color: #3B82F6;">
              <span class="material-symbols-outlined text-white">folder</span>
            </div>
            <div>
              <p id="previewName" class="font-semibold text-gray-800">Group Name</p>
              <p id="previewDesc" class="text-sm text-gray-500">No description</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gray-100">
          <a 
            href="/groups" 
            class="px-6 py-3 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors font-medium text-center order-2 sm:order-1"
          >
            Cancel
          </a>
          <button 
            type="submit" 
            id="submitBtn"
            class="px-8 py-3 bg-primary text-white rounded-xl hover:bg-blue-700 transition-all shadow-md hover:shadow-lg font-semibold flex items-center justify-center gap-2 order-1 sm:order-2"
          >
            <span class="material-symbols-outlined" style="font-size: 20px;">add_circle</span>
            Create Group
          </button>
        </div>
      </form>
    </div>

    <!-- Existing Groups List -->
    <div class="mt-6 bg-white rounded-xl shadow border border-border-color p-6">
      <h3 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined text-primary">folder_open</span>
        Existing Groups
      </h3>
      <div id="groupsList" class="space-y-2">
        <p class="text-gray-500 text-sm">Loading...</p>
      </div>
    </div>
  </main>

  <!-- Toast Notifications -->
  <div id="toast" class="hidden fixed right-6 bottom-6 bg-green-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 toast-animation z-50">
    <span class="material-symbols-outlined">check_circle</span>
    <span id="toastMessage">Group created successfully!</span>
  </div>
  <div id="errorToast" class="hidden fixed right-6 bottom-6 bg-red-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 toast-animation z-50">
    <span class="material-symbols-outlined">error</span>
    <span id="errorToastMessage">Có lỗi xảy ra</span>
  </div>

<script>
// Color selection
const colorOptions = document.querySelectorAll('.color-option');
const colorInput = document.getElementById('colorInput');
const customColorInput = document.getElementById('customColor');
const colorPreview = document.getElementById('colorPreview');
const previewIcon = document.getElementById('previewIcon');

colorOptions.forEach(btn => {
  btn.addEventListener('click', function() {
    // Remove selected from all
    colorOptions.forEach(b => b.classList.remove('selected'));
    // Add selected to clicked
    this.classList.add('selected');
    // Update values
    const color = this.dataset.color;
    colorInput.value = color;
    customColorInput.value = color;
    colorPreview.style.backgroundColor = color;
    previewIcon.style.backgroundColor = color;
  });
});

// Custom color input
customColorInput.addEventListener('input', function() {
  const color = this.value;
  if (/^#[0-9A-Fa-f]{6}$/.test(color)) {
    colorInput.value = color;
    colorPreview.style.backgroundColor = color;
    previewIcon.style.backgroundColor = color;
    // Deselect preset colors
    colorOptions.forEach(b => b.classList.remove('selected'));
  }
});

// Live preview update
const groupNameInput = document.getElementById('groupName');
const descriptionInput = document.getElementById('description');
const previewName = document.getElementById('previewName');
const previewDesc = document.getElementById('previewDesc');
let confirmCallback = null;

// Confirm dialog functions
function showConfirmDialog(title, message) {
  return new Promise((resolve) => {
    document.getElementById('confirm-title').textContent = title;
    document.getElementById('confirm-message').textContent = message;
    document.getElementById('confirm-dialog').classList.remove('hidden');
    confirmCallback = resolve;
  });
}

function hideConfirm(result) {
  document.getElementById('confirm-dialog').classList.add('hidden');
  if (confirmCallback) confirmCallback(result);
}

groupNameInput.addEventListener('input', function() {
  previewName.textContent = this.value || 'Group Name';
});

descriptionInput.addEventListener('input', function() {
  previewDesc.textContent = this.value || 'No description';
});

// Load existing groups
async function loadGroups() {
  const container = document.getElementById('groupsList');
  
  try {
    const response = await fetch('/api/groups');
    const result = await response.json();
    
    if (result.success && result.groups && result.groups.length > 0) {
      container.innerHTML = result.groups.map(group => `
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background-color: ${group.color || '#3B82F6'}">
              <span class="material-symbols-outlined text-white" style="font-size: 16px;">folder</span>
            </div>
            <span class="font-medium text-gray-800">${group.name}</span>
          </div>
          <button onclick="deleteGroup(${group.id})" class="text-gray-400 hover:text-red-500 transition-colors p-1" title="Xóa nhóm">
            <span class="material-symbols-outlined" style="font-size: 18px;">delete</span>
          </button>
        </div>
      `).join('');
    } else {
      container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">No groups yet. Create your first group!</p>';
    }
  } catch (error) {
    console.error('Error loading groups:', error);
    container.innerHTML = '<p class="text-red-500 text-sm">Lỗi tải danh sách nhóm</p>';
  }
}

// Delete group
async function deleteGroup(groupId) {
  const confirmed = await showConfirmDialog('Delete Group', 'Are you sure you want to delete this group?');
  if (!confirmed) return;
  
  try {
    const response = await fetch(`/api/groups/${groupId}`, {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' }
    });
    
    const result = await response.json();
    
    if (response.ok && result.success) {
      showToast('toast', 'Group deleted successfully!');
      loadGroups();
    } else {
      showToast('errorToast', result.message || 'Failed to delete group');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('errorToast', 'Cannot connect to server');
  }
}

// Form submission
document.getElementById('addGroupForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const submitBtn = document.getElementById('submitBtn');
  const originalText = submitBtn.innerHTML;
  
  const name = groupNameInput.value.trim();
  const color = colorInput.value;
  const description = descriptionInput.value.trim();
  
  if (!name) {
    showToast('errorToast', 'Please enter a group name.');
    groupNameInput.focus();
    return;
  }
  
  // Show loading
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="material-symbols-outlined animate-spin" style="font-size: 20px;">sync</span> Creating...';
  
  try {
    const response = await fetch('/api/groups', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, color, description })
    });
    
    const result = await response.json();
    
    if (response.ok && result.success) {
      showToast('toast', `Group "${name}" created successfully!`);
      this.reset();
      // Reset preview
      previewName.textContent = 'Group Name';
      previewDesc.textContent = 'No description';
      previewIcon.style.backgroundColor = '#3B82F6';
      colorPreview.style.backgroundColor = '#3B82F6';
      customColorInput.value = '#3B82F6';
      colorInput.value = '#3B82F6';
      // Reset color selection
      colorOptions.forEach(b => b.classList.remove('selected'));
      document.querySelector('.color-option[data-color="#3B82F6"]').classList.add('selected');
      // Reload groups list
      loadGroups();
    } else {
      showToast('errorToast', result.message || 'Failed to create group');
    }
  } catch (error) {
    console.error('Error:', error);
    showToast('errorToast', 'Cannot connect to server');
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalText;
  }
});

function showToast(toastId, message) {
  document.getElementById('toast').classList.add('hidden');
  document.getElementById('errorToast').classList.add('hidden');
  
  const toast = document.getElementById(toastId);
  const messageEl = document.getElementById(toastId === 'toast' ? 'toastMessage' : 'errorToastMessage');
  messageEl.textContent = message;
  toast.classList.remove('hidden');
  
  setTimeout(() => toast.classList.add('hidden'), 4000);
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  loadGroups();
  groupNameInput.focus();
});
</script>
</body>
</html>